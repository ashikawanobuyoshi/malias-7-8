import{_ as O}from"./DodYhufj.js";import{g as q,j as z,k as N,r as c,l as H,m as T,n as G,p as P,c as s,o as n,a as e,q as A,s as E,t as h,v as K,d as Q,x as W,F as w,y as I,z as V,b as X,w as Y,A as Z}from"./C_xtq39S.js";import{u as ee}from"./CtiIvaeS.js";import{_ as te}from"./DlAUqK2U.js";const le={class:"p-4"},oe={class:"text-xl font-bold mb-2"},ae={key:0,class:"mt-4 text-gray-500"},se={key:1,class:"mt-4 text-gray-500"},ne={class:"image-selector mt-10"},re={class:"monitor-container"},ie={class:"monitor monitor-left"},ue={class:"image-wrapper"},ce=["src","alt"],ve={class:"image-name"},de={class:"monitor monitor-right"},me={class:"image-wrapper"},fe=["src","alt"],he={class:"image-name"},_e={class:"toggle-scroll-link"},ge={class:"thumbnail-container flex gap-4"},pe={class:"flex gap-2"},be=["onClick"],xe=["src","alt"],ke={class:"thumb-name block text-center text-sm mt-1"},ye={class:"flex gap-2"},Ne=["onClick"],we=["src","alt"],Ie={class:"thumb-name block text-center text-sm mt-1"},Ce={class:"favorites-nav"},Se={class:"favorites"},Le={class:"favorites-gallery"},Fe=["onClick"],Te=["src","alt"],Ae=q({__name:"index",setup(Ee,{expose:R}){const C=z(),S=async()=>{localStorage.removeItem("user"),localStorage.removeItem("isAuthenticated");const t=T("isAuthenticated");t.value="",await C.push("/login")},U=N(()=>{try{const t=localStorage.getItem("user");return t?JSON.parse(t).name:"ゲスト"}catch{return"ゲスト"}return"ゲスト"});R({logout:S});const b=c("5_11koyama sama"),v=c([]),_=c(!1),x=c(0),k=c(0),d=N(()=>v.value[x.value]||{url:"",fileName:"画像がありません"}),m=N(()=>v.value[k.value]||{url:"",fileName:"画像がありません"}),r=ee(),i=c(null),u=c(null),y=c(!0);let g=null,p=null;const $=async()=>{console.log("🧪 S3 fetch 処理をスキップ中"),_.value=!0;try{const t=await $fetch("/api/list-images",{method:"GET",params:{folder:b.value}});v.value=t.images.map(l=>({...l,fileName:l.key.split("/").pop()||"(ファイル名不明)"}))}catch(t){console.error("画像取得エラー:",t),v.value=[]}finally{_.value=!1}};function j(t){x.value=t}function B(t){k.value=t}function D(){console.log("🟡 leftImage:",d.value),d.value?L({...d.value}):alert("左画像が選択されていません")}function J(){console.log("🟡 rightImage:",m.value),m.value?L({...m.value}):alert("右画像が選択されていません")}function L(t){if(console.log("🧪 addFavorite 呼び出し:",t),!(typeof t.url=="string"&&t.url.trim()!=="")||!(typeof t.fileName=="string"&&t.fileName.trim()!=="")){console.warn("❌ URL または fileName が未定義または空文字です:",t),alert("画像データが正しく取得できませんでした");return}if(r.favoriteImages.find(l=>l.url===t.url)){alert("この画像はすでにお気に入りに追加されています");return}r.addFavorite({fileName:t.fileName,url:t.url,selectedType:"",quantity:1}),console.log("✅ 追加後のお気に入り一覧:",r.favoriteImages)}function M(t){r.removeFavorite(t)}return H(()=>{console.log("✅ index.vue マウントされました");const t=T("isAuthenticated");console.log("🟣 isAuthenticated クッキー値:",t.value),console.log("🧭 現在のルート:",C.currentRoute.value.fullPath);const l=localStorage.getItem("favoriteImages");if(l)try{const f=JSON.parse(l);r.favoriteImages.splice(0,r.favoriteImages.length,...f)}catch(f){console.error("localStorage からの復元に失敗しました:",f)}}),G(()=>r.favoriteImages,t=>{localStorage.setItem("favoriteImages",JSON.stringify(t))},{deep:!0}),P(()=>{!i.value||!u.value||(i.value.removeEventListener("scroll",g),u.value.removeEventListener("scroll",p),y.value?(g=()=>{u.value&&i.value&&(u.value.scrollLeft=i.value.scrollLeft)},p=()=>{i.value&&u.value&&(i.value.scrollLeft=u.value.scrollLeft)},i.value.addEventListener("scroll",g),u.value.addEventListener("scroll",p)):(g=null,p=null))}),(t,l)=>{const f=O;return n(),s("div",le,[l[5]||(l[5]=e("h1",null,"✅ トップページに来ました",-1)),e("h1",oe,"ようこそ、"+h(U.value)+" さん。",1),e("button",{onClick:S,class:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"}," ログアウト "),l[6]||(l[6]=e("h1",{class:"text-2xl font-bold mb-4"},"フォルダ内の画像ギャラリー",-1)),A(e("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>b.value=o),type:"text",placeholder:"例: 5_11koyama sama",class:"border border-gray-300 p-2 rounded mb-4 w-full"},null,512),[[K,b.value]]),e("button",{onClick:$,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"}," 画像を読み込む "),_.value?(n(),s("div",ae,"読み込み中...")):E("",!0),!_.value&&v.value.length===0?(n(),s("div",se,"画像が見つかりません。")):E("",!0),e("div",ne,[e("div",re,[e("div",ie,[e("div",ue,[e("img",{src:d.value.url,alt:d.value.fileName},null,8,ce)]),e("div",ve,h(d.value.fileName),1)]),e("div",de,[e("div",me,[e("img",{src:m.value.url,alt:m.value.fileName},null,8,fe)]),e("div",he,h(m.value.fileName),1)])]),e("div",_e,[e("label",null,[A(e("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=o=>y.value=o)},null,512),[[W,y.value]]),l[2]||(l[2]=Q(" サムネイルのスクロールを連動させる "))])]),e("div",ge,[e("div",{ref_key:"leftThumbnail",ref:i,class:"thumbnail left-thumbnail overflow-x-auto whitespace-nowrap w-full"},[e("div",pe,[(n(!0),s(w,null,I(v.value,(o,a)=>(n(),s("div",{key:"left-"+a,class:V(["thumbnail-item flex-shrink-0 w-32",{active:a===x.value}]),onClick:F=>j(a)},[e("img",{src:o.url,alt:o.fileName,class:"w-full h-auto object-contain rounded"},null,8,xe),e("span",ke,h(o.fileName),1)],10,be))),128))])],512),e("div",{ref_key:"rightThumbnail",ref:u,class:"thumbnail right-thumbnail overflow-x-auto whitespace-nowrap w-full"},[e("div",ye,[(n(!0),s(w,null,I(v.value,(o,a)=>(n(),s("div",{key:"right-"+a,class:V(["thumbnail-item flex-shrink-0 w-32",{active:a===k.value}]),onClick:F=>B(a)},[e("img",{src:o.url,alt:o.fileName,class:"w-full h-auto object-contain rounded"},null,8,we),e("span",Ie,h(o.fileName),1)],10,Ne))),128))])],512)]),e("div",{class:"controls"},[e("button",{onClick:D},"お気に入りに追加（左画像）"),e("button",{onClick:J},"お気に入りに追加（右画像）")]),e("div",Ce,[X(f,{to:"/favorites"},{default:Y(()=>l[3]||(l[3]=[e("button",{class:"favorites-button"},"お気に入りページへ",-1)])),_:1,__:[3]})]),e("div",Se,[l[4]||(l[4]=e("h3",null,"お気に入り画像",-1)),e("div",Le,[(n(!0),s(w,null,I(Z(r).favoriteImages,(o,a)=>(n(),s("div",{key:a,class:"favorite-item",onClick:F=>M(a)},[e("img",{src:o.url,alt:o.fileName},null,8,Te)],8,Fe))),128))])])])])}}}),je=te(Ae,[["__scopeId","data-v-e55d641d"]]);export{je as default};
