{"version":3,"file":"login-B43bLAo4.js","sources":["../../../../pages/login.vue"],"sourcesContent":["<template>\r\n    <client-only>\r\n  <form @submit.prevent=\"handleLogin\">\r\n    <input\r\n      type=\"email\"\r\n      v-model=\"email\"\r\n      name=\"email\"\r\n      id=\"email\"\r\n      autocomplete=\"email\"\r\n      placeholder=\"メールアドレス\"\r\n      required\r\n    />\r\n    <input\r\n      type=\"password\"\r\n      v-model=\"password\"\r\n      name=\"password\"\r\n      id=\"password\"\r\n      autocomplete=\"current-password\"\r\n      placeholder=\"パスワード\"\r\n      required\r\n    />\r\n    <button type=\"submit\">ログイン</button>\r\n    <p v-if=\"errorMessage\">{{ errorMessage }}</p>\r\n  </form>\r\n  </client-only>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, nextTick } from 'vue' // nextTick を追加\r\nimport { useRouter } from 'vue-router'\r\nimport { useCookie } from '#app'\r\n\r\nconst email = ref('')\r\nconst password = ref('')\r\nconst errorMessage = ref('')\r\n\r\nconst router = useRouter()\r\n\r\nconst handleLogin = async () => {\r\n  console.log('handleLogin実行')\r\n  try {\r\n    const res = await $fetch('/api/login', {\r\n      method: 'POST',\r\n      body: { email: email.value, password: password.value }\r\n    })\r\n\r\n    console.log('✅ レスポンス:', res)\r\n\r\n    if (res.success) {\r\n      console.log('✅ ユーザー保存:', res.user)\r\n\r\n      localStorage.setItem('user', JSON.stringify(res.user))\r\n      localStorage.setItem('isAuthenticated', 'true')\r\n\r\n      const isAuthenticated = useCookie('isAuthenticated')\r\n      isAuthenticated.value = 'true'\r\n\r\n      await nextTick()  \r\n      await new Promise((resolve) => setTimeout(resolve, 100))\r\n\r\n      console.log('🔁 トップページへ遷移実行')\r\n      await router.push('/')\r\n\r\n      console.log('✅ 遷移成功')\r\n    } else {\r\n      errorMessage.value = 'メールアドレスまたはパスワードが間違っています。'\r\n    }\r\n  } catch (err) {\r\n    console.error('ログイン失敗:', err)\r\n    errorMessage.value = '通信エラーが発生しました。'\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAgCc,QAAI,EAAE;AACH,QAAI,EAAE;AACF,QAAI,EAAE;AAEZ,cAAA;;;;;;;;;;;;;"}